@{
    ViewBag.Title = "ViewResult";
}

@using System.Configuration
@using UniversityManagementApp.Models;
@model Enroll








<div class="card shadow p-1 text-white  bg-dark col-md-10 mx-auto rounded">
    @*Every title of Page will shown using following Div*@
    <div class="card-header text-center bg-light text-primary">
        <h2> View Student Result</h2>
    </div>

    @*User will input all kind off data using this section*@
    <br />
    <div class="mt-1 col-md-12 text-xl-right">
        <a class="btn  btn-outline-info" href="SaveStudentResult" role="button"> Save Result</a>
    </div>
    <div class="card-body" id="printarea">

        @using (Html.BeginForm())
        {

            @*Reg No list*@
            <div class="input-group mt-2 mx-auto col-md-5">
                <div class="input-group-prepend">
                    <label class="input-group-text" for="RegNo">Reg No : &nbsp;&nbsp;</label>
                </div>
                @Html.DropDownListFor(x => x.RegNo, new SelectList(ViewBag.RegNo, "Value", "Text"), new { @class = "form-control", required = "true" })
                @Html.ValidationMessageFor(x => x.RegNo, null, new { @class = "error", @id = "RegNo-error" })
            </div>



            // Name of Student just view
            <div class="input-group mt-2 mx-auto col-md-5">
                <div class="input-group-prepend">
                    <label for="Name" class="input-group-text">Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
                </div>

                @Html.TextBoxFor(x => x.Name, null, new { @placeholder = "Name of The Student ", @class = "form-control", disabled = "true" })

            </div>
            // Email of Student just view
            <div class="input-group mt-2 mx-auto col-md-5">
                <div class="input-group-prepend">
                    <label for="Email" class="input-group-text">Email&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
                </div>

                @Html.TextBoxFor(x => x.Email, null, new { @placeholder = "name@example.com", @class = "form-control", disabled = "true" })

            </div>

            // Department of Student just view
            <div class="input-group mt-2 mx-auto col-md-5">
                <div class="input-group-prepend">
                    <label for="Department" class="input-group-text">Department</label>
                </div>

                @Html.TextBoxFor(x => x.Department, null, new { @placeholder = "", @class = "form-control", disabled = "true" })



            </div>




            <div class="mt-2 mx-auto col-md-5 text-xl-right">
                @*@Html.ActionLink("MakePdf", "PrintViewToPdf", "Result")*@
                <input class="btn btn-primary mt-2 mr-2" type="button" value="MakePdf" onclick="myPrint" id="cmd">
            </div>
        }


        <div id="resultt">
            <table class="table col-md-10 mx-auto bg-primary p-2 mt-2" >
                <thead>
                    <tr>
                        <td scope="col"> Course Code</td>
                        <td scope="col">Name</td>
                        <td scope="col">Grade</td>
                    </tr>
                </thead>
                <tbody></tbody>

                <tbody id="result" class="table-info mt-2 bg-secondary p-2"></tbody>
            </table>


        </div>

        <div id="editor">

        </div>
        
    </div>

</div>

@section scripts
{
    <script>

        $(document).ready(function () {

            $("#RegNo").change(function () {

                var regNo = $("#RegNo").val();
                if (regNo != "--Choice--") {
                    var json = { regNo: regNo };
                    $.ajax({
                        type: "POST",
                        url: '@Url.Action("GetStudentbyregNo", "Enroll")',
                        contentType: "application/json; charset=utf-8",
                        cache: false,
                        data: JSON.stringify(json),
                        success: function (data) {
                            $("#Name").empty();
                            $("#Email").empty();
                            $("#Department").empty();
                            if (data != null) {
                                $("#Name").val(data.Name);
                                $("#Email").val(data.Email);
                                $("#Department").val(data.Department);
                            }
                        }
                    });
                }

            });


            $("#RegNo").change(function () {

                var regNo = $("#RegNo").val();
                if (regNo != "--Choice--") {
                    var json = { regNo: regNo };
                    $.ajax({
                        type: "POST",
                        url: '@Url.Action("GetStudentResultbyregNo", "Result")',
                        contentType: "application/json; charset=utf-8",
                        cache: false,
                        data: JSON.stringify(json),
                        success: function (data) {
                            if (data != null) {
                                $("#result").empty();
                                $.each(data, function (key, value) {
                                    $("#result").append("<tr><td>" + value.CourseCode + "</td><td>" + value.Name + "</td><td>" + value.Grade + "</td></tr>");
                                });
                            }
                        }
                    });
                }

            });


        });


    </script>
    
    <script src="https://code.jquery.com/jquery-3.0.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/jspdf/1.2.61/jspdf.min.js"></script>
    <script type='text/javascript'>
       // Script for pdf output
        var doc = new jsPDF('p', 'mm'[270, 210]);
        var specialElementHandlers = {
                '#editor': function (element, renderer) {
                    return true;
                }
            };
          
        $('#cmd').click(function () {
            var Reg_val = $('#RegNo').val();
            var name_val = $('#Name').val();
            var department_val = $('#Department').val();
            var email_val = $('#Email').val();
            doc.text(60, 10, 'Students : ' + name_val + '- Results');
                doc.text(20, 25, 'RegNo        : ' + Reg_val);
                doc.text(20, 35, 'Name         : ' + name_val);
                doc.text(20, 45, 'Department: ' + department_val);
                doc.text(20, 55, 'Email        : ' + email_val);
                doc.text(60, 65, 'Subject Wise Grade/ Marksheet');
                doc.fromHTML($('#resultt').html(), 30, 70, {
                    'width': 150,
                    'elementHandlers': specialElementHandlers
                });
                doc.save(Reg_val+'-Result.pdf');
            });
    
       

    </script>
}